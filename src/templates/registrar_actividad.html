{% extends 'base.html' %}

{% block title %}Registrar Actividad{% endblock %}

{% block CustomCSS %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link rel="stylesheet" href="{{ url_for('static', filename='css/registrar_actividad.css') }}">
{% endblock %}

{% block body %}
<div class="logo">
    <img src="{{ url_for('static', filename='img/logo_icon.png') }}" alt="Logo">
</div>

<!-- Bot√≥n volver -->
<div class="logout-btn">
    <a href="{{ url_for('home') }}">
        <button title="Volver al inicio">
            <i class="fa-solid fa-arrow-left"></i>
        </button>
    </a>
</div>

<div class="actividad-container">
    <div class="header-actividad">
        <i class="fas fa-clipboard-check"></i>
        <h1>Registrar Actividad Diaria</h1>
    </div>

    <form method="POST" enctype="multipart/form-data">
        <!-- Grid de formulario -->
        <div class="form-grid">
            <!-- Columna izquierda: Formulario -->
            <div class="form-column">
                <!-- Cultivo -->
                <div class="form-group">
                    <label for="cultivo">
                        <i class="fas fa-seedling"></i> Cultivo
                    </label>
                    <select name="cultivo" id="cultivo" required>
                        <option value="">Selecciona un cultivo</option>
                        {% for cultivo in cultivos %}
                            <option value="{{ cultivo[0] }}">{{ cultivo[1] }}</option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Tipo de actividad -->
                <div class="form-group">
                    <label for="actividad">
                        <i class="fas fa-tasks"></i> Tipo de Actividad
                    </label>
                    <select name="actividad" id="actividad" required>
                        <option value="">Selecciona una actividad</option>
                        <option value="Cosecha"> Cosecha</option>
                        <option value="Fumigaci√≥n"> Fumigaci√≥n</option>
                        <option value="Riego"> Riego</option>
                        <option value="Fertilizaci√≥n"> Fertilizaci√≥n</option>
                        <option value="Poda"> Poda</option>
                        <option value="Control de plagas"> Control de plagas</option>
                        <option value="Limpieza"> Limpieza del terreno</option>
                        <option value="Mantenimiento"> Mantenimiento</option>
                        <option value="Otro"> Otro</option>
                    </select>
                </div>

                <!-- Insumos -->
                <div class="form-group">
                    <label for="insumos">
                        <i class="fas fa-boxes"></i> Insumos Utilizados
                        <span class="label-helper">(Mant√©n presionado Ctrl para seleccionar varios)</span>
                    </label>
                    <select name="insumos" id="insumos" multiple required size="8">
                        <optgroup label="üåø Fertilizantes">
                            <option value="Abono org√°nico">Abono org√°nico</option>
                            <option value="Fertilizante qu√≠mico">Fertilizante qu√≠mico</option>
                            <option value="Cal agr√≠cola">Cal agr√≠cola</option>
                            <option value="Urea">Urea</option>
                        </optgroup>
                        <optgroup label="üêõ Control de Plagas">
                            <option value="Insecticida">Insecticida</option>
                            <option value="Aceite de neem">Aceite de neem</option>
                            <option value="Trampa para insectos">Trampa para insectos</option>
                        </optgroup>
                        <optgroup label="üçÑ Control de Hongos">
                            <option value="Fungicida">Fungicida</option>
                            <option value="Trichoderma">Trichoderma</option>
                            <option value="Caldo bordel√©s">Caldo bordel√©s</option>
                        </optgroup>
                        <optgroup label="üå± Mejoradores de Suelo">
                            <option value="Compost">Compost</option>
                            <option value="Esti√©rcol">Esti√©rcol</option>
                            <option value="Humus">Humus</option>
                        </optgroup>
                        <optgroup label="üíß Riego">
                            <option value="Agua">Agua</option>
                            <option value="Sistema de riego">Sistema de riego</option>
                        </optgroup>
                        <optgroup label="üîß Herramientas">
                            <option value="Azad√≥n">Azad√≥n</option>
                            <option value="Machete">Machete</option>
                            <option value="Tijeras de podar">Tijeras de podar</option>
                            <option value="Fumigadora">Fumigadora</option>
                        </optgroup>
                    </select>
                    <small class="form-hint">
                        <i class="fas fa-info-circle"></i> 
                        Seleccionados: <span id="insumos-count">0</span>
                    </small>
                </div>

                <!-- Observaciones -->
                <div class="form-group">
                    <label for="observaciones">
                        <i class="fas fa-comment-alt"></i> Observaciones
                    </label>
                    <textarea
                        name="observaciones"
                        id="observaciones"
                        rows="5"
                        placeholder="Describe los detalles de la actividad realizada..."
                        required
                    ></textarea>
                    <small class="form-hint">
                        <i class="fas fa-info-circle"></i> 
                        Caracteres: <span id="char-count">0</span>/500
                    </small>
                </div>
            </div>

            <!-- Columna derecha: Evidencia fotogr√°fica -->
            <div class="evidencia-column">
                <div class="evidencia-card">
                    <div class="evidencia-header">
                        <i class="fas fa-camera"></i>
                        <h3>Evidencia Fotogr√°fica</h3>
                    </div>

                    <div class="camera-box">
                        <video id="video" autoplay playsinline></video>
                        <canvas id="canvas" style="display: none"></canvas>
                        <img id="preview" class="preview" style="display: none" />
                    </div>

                    <div class="camera-buttons">
                        <button type="button" id="tomarFoto" class="btn-camera">
                            <i class="fas fa-camera"></i> Tomar Foto
                        </button>
                        <button type="button" id="borrarFoto" class="btn-delete">
                            <i class="fas fa-trash"></i> Borrar
                        </button>
                    </div>

                    <a href="{{ url_for('ver_fotos') }}" class="btn-ver-fotos">
                        <i class="fas fa-images"></i> Ver Mis Fotos
                    </a>

                    <input type="hidden" id="evidenciaInput" name="evidencia" />
                </div>

                <!-- Info adicional -->
                <div class="info-box">
                    <i class="fas fa-lightbulb"></i>
                    <p><strong>Tip:</strong> La evidencia fotogr√°fica aumenta tu puntuaci√≥n de productividad</p>
                </div>
            </div>
        </div>

        <!-- Bot√≥n de env√≠o -->
        <div class="form-footer">
            <button type="submit" class="btn-guardar">
                <i class="fas fa-save"></i> Guardar Actividad
            </button>
        </div>
    </form>
</div>

<div class="planta">
    <img src="{{ url_for('static', filename='img/plantaa.png') }}" alt="planta">
</div>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div id="flash-data" data-icon="{{ category }}" data-message="{{ message }}"></div>
    {% endfor %}
  {% endif %}
{% endwith %}

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="{{ url_for('static', filename='js/registrar_actividad.js') }}"></script>

{% endblock %}