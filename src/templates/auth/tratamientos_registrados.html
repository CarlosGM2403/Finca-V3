{% extends 'base.html' %}

{% block title %}Tratamientos Registrados{% endblock %}

{% block CustomCSS %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/tratamientos.css') }}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
{% endblock %}

{% block body %}

<!-- Logo -->
<div class="logo">
    <img src="{{ url_for('static', filename='img/logo_icon.png') }}" alt="Logo">
</div>

<!-- Título -->
<h1 class="Titulo">Tratamientos Registrados</h1>

<!-- Botón volver al inicio -->
<div class="logout-btn">
  <a href="{{ url_for('home') }}">
    <button title="Volver al inicio">
      <i class="fa-solid fa-arrow-left"></i>
    </button>
  </a>
</div>

<!-- Contenedor principal -->
<div class="containerSiembra">

  <!-- Buscador -->
  <div class="buscador-contenedor">
    <input type="text" id="buscador-tratamientos" placeholder="Buscar tratamientos...">
  </div>

  <div class="tabla-contenedor">
    <form method="POST" action="{{ url_for('guardar_comentarios') }}">
      <table class="tabla-tratamientos" id="tabla-tratamientos">
        <thead>
          <tr>
            <th>Cultivo</th>
            <th>Tratamiento</th>
            <th>Problema</th>
            <th>Prioridad</th>
            <th>Insumos</th>
            <th>Fecha Registro</th>
            {% if rol_usuario == 'administrador' %}
            <th>Comentarios</th>
            {% endif %}
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for t in tratamientos %}
          <tr>
            <td>{{ t[1] }}</td> <!-- cultivo -->
            <td>{{ t[2] }}</td> <!-- tratamiento -->
            <td>{{ t[3] }}</td> <!-- problema -->
            <td>{{ t[4] }}</td> <!-- prioridad -->
            <td>{{ t[5] }}</td> <!-- insumos -->
            <td>{{ t[6] }}</td> <!-- fecha -->

            {% if rol_usuario == 'administrador' %}
            <td>
              <!-- textarea con nombre único para cada tratamiento -->
              <textarea name="comentario_{{ t[0] }}" rows="2" cols="30">{{ t[7] if t|length > 7 else '' }}</textarea>
            </td>
            {% endif %}

            <td>
              <a href="{{ url_for('eliminar_tratamiento', id=t[0]) }}">
                <button class="btn-guardar" type="button">Eliminar</button>
              </a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      <p id="no-result-siembra" class="NoResultado" style="display: none;">
      No se encontraron evidencias que coincidan con la búsqueda.
    </p>
  </div>

      {% if rol_usuario == 'administrador' %}
      <div style="margin-top:10px;">
        <button type="submit" class="btn-guardar">Guardar Comentarios</button>
      </div>
      {% endif %}
    </form>

  <!-- Botón inferior -->
  <div class="botones">
    <a href="{{ url_for('seguimiento_cultivo') }}">
      <button class="btn-guardar">Registrar Nuevo Tratamiento</button>
    </a>
  </div>
</div>

<!-- Imagen decorativa -->
<img src="{{ url_for('static', filename='img/plantaa.png') }}" class="planta" alt="Planta decorativa">

<script src="{{ url_for('static', filename='js/tratamientos_registrados.js') }}"></script>

{% endblock %}
