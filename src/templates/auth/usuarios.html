{% extends 'base.html' %}

{% block title %}Usuarios{% endblock %}

{% block CustomCSS %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/usuarios.css') }}">
{% endblock %}

{% block body %}

<h1 class="titulo-principal">Lista de Usuarios</h1>

<div class="cuadro-usuarios">

  <div class="buscador-contenedor">
    <input type="text" id="buscador" placeholder="Buscar usuario...">
  </div>

  <!-- Contenedor con scroll SOLO para la tabla -->
  <div class="tabla-contenedor">
    <table class="tabla-usuarios" id="tabla-usuarios">
      <thead>
        <tr>
          <th>Nombre</th>
          <th>Rol</th>
          <th>Estado</th>
          <th>Fecha Registro</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for usuario in usuarios %}
        <tr>
          <td>{{ usuario[1] }}</td>
          <td>{{ usuario[2] }}</td>
          <td>{{ usuario[3] }}</td>
          <td>{{ usuario[4] }}</td>
          <td>
            <a href="{{ url_for('cambiar_estado', id=usuario[0]) }}">
              <button class="btn-normal">Editar Usuario</button>
            </a>
          </td>
        </tr>
        {% endfor %}
        <tr id="no-result" style="display:none;">
          <td colspan="5" style="text-align:center; color:#f00;">No se encontraron resultados</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Botones inferiores -->
  <div class="acciones">
    <a href="{{ url_for('registrar_usuario') }}">
      <button class="btn-normal">Registrar Usuario</button>
    </a>

    <a href="{{ url_for('home') }}">
      <button class="btn-normal">Volver al Inicio</button>
    </a>
  </div>

</div>

{% endblock %}

{% block scripts %}
<script>
const buscador = document.getElementById('buscador');
const tabla = document.getElementById('tabla-usuarios').getElementsByTagName('tbody')[0];
const filas = tabla.getElementsByTagName('tr');
const noResult = document.getElementById('no-result');

buscador.addEventListener('input', function() {
    const filtro = this.value.toLowerCase().trim();
    let coincidencias = 0;

    for (let i = 0; i < filas.length; i++) {
        if (filas[i].id === 'no-result') continue;

        const celdas = filas[i].getElementsByTagName('td');
        let textoFila = '';
        for (let j = 0; j < celdas.length - 1; j++) {
            textoFila += celdas[j].textContent.toLowerCase() + ' ';
        }

        if (textoFila.includes(filtro)) {
            filas[i].style.display = '';
            coincidencias++;
        } else {
            filas[i].style.display = 'none';
        }
    }

    if (coincidencias === 0) {
        noResult.style.display = '';
    } else {
        noResult.style.display = 'none';
    }
});
</script>
{% endblock %}
