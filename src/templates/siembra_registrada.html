{% extends 'base.html' %}

{% block title %}Siembra Registrada{% endblock %}

{% block CustomCSS %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="{{ url_for('static', filename='css/siembra_registrada.css') }}">
{% endblock %}

{% block body %}

<h2 class="Titulo">Lista de Siembras Registradas</h2>

<div class="cuadro-siembra">

  <div class="buscador-contenedor">
    <input type="text" id="buscador-siembra" placeholder="Buscar siembras...">
  </div>

    <div class="tabla-contenedor">
        <table class="tabla-siembra" id="tabla-siembra">
            <thead>
                <tr>
                    <th>Fecha de Siembra</th>
                    <th>Detalle</th>
                    <th>Cultivo</th>
                </tr>
            </thead>
    <tbody>
      {% for r in registros %}
      <tr>
        <td>{{ r[0] }}</td> <!-- fecha_siembra -->
        <td>{{ r[1] }}</td> <!-- detalle -->
        <td>{{ r[2] }}</td> <!-- cultivo_nombre -->
        </td>
      </tr>
      {% endfor %}
    </tbody>
    </table>
</div>

  <div class="mt-4">
    <a href="{{ url_for('registrar_siembra') }}" class="btn btn-success">Registrar Nueva Siembra</a>
    <a href="{{ url_for('home') }}" class="btn btn-secondary">Volver al Inicio</a>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', () => {
    const buscador = document.getElementById('buscador-siembra');
    const tabla = document.getElementById('tabla-siembra').getElementsByTagName('tbody')[0];
    const filas = tabla.getElementsByTagName('tr');
    const noResult = document.getElementById('no-result-siembra');

    buscador.addEventListener('input', function() {
        const filtro = this.value.toLowerCase().trim();
        let coincidencias = 0;

        for (let i = 0; i < filas.length; i++) {
            if (filas[i].id === 'no-result-siembra') continue;

            const celdas = filas[i].getElementsByTagName('td');
            let textoFila = '';
            for (let j = 0; j < celdas.length; j++) {
                textoFila += celdas[j].textContent.toLowerCase() + ' ';
            }

            if (textoFila.includes(filtro)) {
                filas[i].style.display = '';
                coincidencias++;
            } else {
                filas[i].style.display = 'none';
            }
        }

        noResult.style.display = (coincidencias === 0) ? '' : 'none';
    });
});
</script>
{% endblock %}